# LTtx数据中心

# LTtx简介
1、LTtx是一个分布式数据中心，基于Python语言开发，为分布式服务架构提供基础的通信服务。本项目代码完全开源，由于处于开源初期，相应的代码未完全整理，作者主要是用在股票量化的开发，在实际运用中，start_tx()对中国股市全市场Level1的Tick行情推送可以胜任。基于LTtx数据中心，可以实现许多程序的拆分，各个模块间相互独立，相互配合，也可以做成常用的服务端————客户端模型。在V3新版本中，新增文件传输功能，为实际开发提供更加全面的功能支持，此外本项目会根据实际生产环境需要，开发新的功能。

2、对于高并发的推送需求，可以采用start_plus()模式和start_MQ()模式。

3、对于普通应用场景，我们不建议使用zeroMQ的start_MQ()模式，因为这需要服务端再开启另外两个端口，这种方法更适合在局域网内使用，另外zeroMQ模式未做连接认证处理，存在数据泄漏的风险。

# 应用场景
1、分布式量化交易系统    
2、聊天系统     
3、网络认证     
4、中间件       
5、个人云盘     
6、其他网络应用


# 模式说明
## 1、put/get（存储）模式

普通数据存储，可以在数据中心进行数据存储，任意客户端可以访问该数据。另外还提供了Python基础的字典和列表对象操作方法，客户端可以通过此类方法对数据中心的数据进行操作。

## 2、push（广播）模式

消息推送模式，可以实现任意客户端之间的数据推送，比如A客户端可以向B客户端进行消息推送，C客户端也可以A客户端进行消息推送，具体的交互方式参见下方的push()方法，在push模式中有普通的push()和push_plus()和MQ_push()三种方式，他们功能类似，区别点在于速度和数据安全性上，其中MQ_push()是最快的模式，详细区别如下：

|  模式   | 百万条数据耗时 |数据安全性 |开启方式|
|  :----:  | :----:  | :----:  | :----:  |
| push   |  20s    |强|  start_tx() |
| push_plus  | 8s  |强|  start_plus()|
| MQ_push  | 1.7s  |弱|  start_MQ()|

## 3、文件传输模式
该模式可以实现客户端和服务端之间的文件传输功能，当A客户端把test.txt文件上传至数据中心时，B客户端可以通过文件传输模式获取到该文件。

集成了zeroMQ的代理模式进行数据推送，使得数据推送更快，延迟更低，该模式需要单独开启才行，另外当前版本中作者并未对连接进行登录验证，在开发时一直没有成功实现验证码登录，希望可以得到朋友们的实现。


# 部署方式
1、本项目是基于服务端———客户端的架构方式，在使用时需要先运行服务端程序。启动方式也特别简单，git在对应的服务器（可以是Windows,Linux,只要能运行Python文件即可）后通过Python启动，如果是在Linux服务器中请留意放开对应的端口。

2、由于Python的GIL属性，服务端采用了大量的子线程进行功能实现，为保证性能发挥，建议部署在Linux服务器上，并且通过绑定核心运行的方法使用服务端性能达到最优。绑定核心启动命令示例：
```
taskset -c 2 python pg_server.py
```
本命令可将程序绑定在CPU2上。绑定核心后经本人测试发现在高并发时可以提高大约80%以上的性能。如果您的CPU是12代英特尔，请务必让他运行在性能（大核）核心上。

## 重要功能函数说明
````
#需要提前执行start_tx()函数
put("a","b")                   #把云变量“a"赋值为“b",二者均为字符串，新版本中V3中将不再对b进行字符串数据类型进行限制。  

get("a")                       #获取云变量“a"的值。当put时传入的是一个Python对象，那么获得的值也是一个Python对象。  

dict_change(var,key,value)     #把云对象var字典对象进行key和value的更新，同本地字典操作方法一致。     

list_pop(var,data)             #把云对象var列表对象进行列表的pop操作，同本地列表操作方法一致。  

list_remove(var,data)          #把云对象var列表对象进行列表的remove操作，同本地列表操作方法一致。  

push("a","abc","test")         #向“test“信道发送消息

push_plus("a","abc","test")    #是push的升级版本，可以快速完成数据推送，使用前需要先start_plus()，该方法需要大于V4版本才能使用

MQ_push('a'.'abc','test')      #是push模式的ZMQ版本，相比较于push_plus更快，适合大通量的场景，但由于当前版本中未对ZMQ的连接进行加密验证，因此存在安全漏洞，如果数据不是非常重要但又对速度和延迟有着极高的要求，可以采用这种模式

````

## 客户端使用示例
```
from tx import *
tx1 = txl('192.168.1.65',2025,'LTtx')        #连接服务器 'LTtx'为认证的token,因服务端变化而变化。
tx1.start_tx()                               #开启put/get/push功能
tx1.start_txg("test")                        #开启接收信道"test"消息的功能，
tx1.start_MQ()                               #开启ZMQ模式中的MQ_push功能
tx1.start_MQ_broadcast('test')               #开启ZMQ模式中的广播进行数据接收，同start_txg()

详细使用方法参考/使用示例/基础使用示例.py

若不用可以不开启该功能，开启后，所有的广播（订阅）数据通过tx1.Q.get()进行获取
tx1.push_plus("a","abc","test")    #是push的升级版本，可以快速完成数据推送，使用前需要先start_plus()，该方法需要大于V4版本才能使用
```





## 


## 特别说明
1、客户端在使用时注意子线程的死循环，最好是加上0.1秒的延迟或者阻塞队列，不要让CPU空转导到客户端无法接收消息。




## 升级日志
#### 2024.3.21---------V6
1、客户端新增一些常用函数方法，详情见./客户端函数.md。  
2、服务端和客户端新增自适应ZMQ，如果本地环境没有ZMQ库，将不会影响其他功能的使用。    
3、修复心跳模式bug。  
4、更改代码结构，去除历史版本。  


#### 2023.8.4---------V5
1、将zeroMQ中的代理模式集成到本系统，使基可以更高效、快速、低延时的进行数据推送。但暂未实现连接zeroMQ时进行登录验证。

#### 2023.8.4---------V4
1、升级整体架构，原功能方法保持不变，提升高并发数据时数据的推送性能。

2、新增push_plus()方法，该方法是push()方法的升级版本，推送性能有2至3倍提升，更适合交易行情的推送。

3、新版本服务端将自动绑定CPU核心，默认会绑定最后一颗CPU核心以提升性能（有2倍左右的性能提升）

#### 2023.7.24---------V3
1、新增文件传输功能，支持文件上传和下载，云端文件保存目录在/file_data/路径中，文件传输为单次短连接，传输完成后会有MD5校验，但没有重传机制。

2、更新内部代码逻辑，在put时可以传入基础的Python对象（只要是Json库支持的即可，例如字典，列表等，但不支持dataframe，如果要保存dataframe请先将dataframe转为字典进行保存，然后再通过
字典转dataframe完成存储）。注意，当传入一个字典对象时，通过get得到的将是一个字典对象，不再是字符串。这也意味着不用每次云变量赋值时进行json.dumps()操作。

3、新增基础的云变量量字典对象操作，详请见方法说明dict_change(var,key,value)。

4、新增基础的列表操作方法list_pop()和list_remove(),原理和正常的操作一样。


#### 2023.7.13---------V2

1、升级服务端消息推送方式，防止因为单个客户端不能接受消息而造成其他客户端不能收到消息，这主要是在大通量数据推送时会发生。

#### 2023.6.1---------V1.1  
1、新增多信道订阅，在start_txg()时传入"hq_center@cb_hq_center"表示同时订阅hq_center信道和cb_hq_center信道。

2、优化代码逻辑，防止粘包。

## 待开发功能


1、开发配套同步程序，该程序会使各个PG数据中心的新增云变量保持一致，为分布式部署提供保障，防止因为单个服务端故障后影响其他程序正常运行。


## 写在最后
祝大家使用愉快，欢迎加本人VX，共同探讨量化交易的开发乐趣。

#### LTtx作者微信：

## 本项目star:
[![Stars](https://img.shields.io/github/stars/95ge/LTtx.svg)](https://github.com/95ge/LTtx)

## star走势
[![Star history](https://star-history.t9t.io/#95ge/LTtx)](https://star-history.t9t.io/#95ge/LTtx)







